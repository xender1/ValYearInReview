<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valorant Year In Review 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff4655, #ff758c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .subtitle:last-of-type {
            margin-bottom: 40px;
        }

        /* Squad Highlights Section */
        .squad-section {
            margin-bottom: 50px;
        }

        .squad-section h2 {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: #ff758c;
        }

        .highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
        }

        .highlight-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .highlight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(255, 70, 85, 0.2);
        }

        .highlight-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ff4655;
            margin-bottom: 8px;
        }

        .highlight-value.name {
            font-size: 1.2rem;
        }

        .highlight-label {
            color: #aaa;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Players Grid */
        .players-section h2 {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: #ff758c;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 1000px) {
            .players-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .players-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Player Card */
        .player-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-card:hover {
            border-color: #ff4655;
            box-shadow: 0 0 30px rgba(255, 70, 85, 0.3);
        }

        .player-card.expanded {
            grid-column: 1 / -1;
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff4655, #ff758c);
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: bold;
            flex-shrink: 0;
            color: transparent;
        }

        .player-info h3 {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }

        .player-info .tag {
            color: #888;
            font-size: 0.85rem;
        }

        .player-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-summary-stat {
            text-align: center;
        }

        .player-summary-stat .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff758c;
        }

        .player-summary-stat .label {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
        }

        .click-hint {
            color: #666;
            font-size: 0.75rem;
            margin-top: 12px;
            text-align: center;
        }

        /* Expanded Details */
        .player-details {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-details.expanded {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ff758c;
        }

        .stat-label {
            color: #888;
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .best-match {
            background: rgba(255, 70, 85, 0.1);
            border: 1px solid rgba(255, 70, 85, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .best-match h4 {
            color: #ff4655;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .best-match-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .best-match-stat {
            display: flex;
            flex-direction: column;
        }

        .best-match-stat span:first-child {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .best-match-stat span:last-child {
            color: #888;
            font-size: 0.7rem;
        }

        .stack-names {
            color: #fff;
            font-size: 0.9rem;
        }

        .maps-section {
            margin-top: 20px;
        }

        .maps-section h4 {
            margin-bottom: 10px;
            color: #ff4655;
            font-size: 0.95rem;
        }

        .map-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .map-name {
            width: 80px;
            font-size: 0.8rem;
        }

        .map-bar-fill {
            height: 20px;
            background: linear-gradient(90deg, #ff4655, #ff758c);
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.75rem;
            min-width: 35px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Year In Review</h1>
        <p class="subtitle">Truck Chat Valorant 2025* Competitive Journey</p>
        <p class="subtitle">(Accurate data from ~Oct 18th onward)</p>
        

        <div id="content">
            <div class="loading">Loading match data...</div>
        </div>
    </div>

    <script>
        async function loadAllData() {
            try {
                const response = await fetch('stats.json');
                if (!response.ok) throw new Error('Failed to load stats.json');
                const data = await response.json();

                const uniqueMatches = data.uniqueMatches;
                const squadWins = data.squadWins;
                const bestStack = data.bestStack;
                const allStacks = data.allStacks || [];
                const allPlayerData = data.playerStats;

                // Transform data to match expected format
                const formattedData = allPlayerData.map(player => ({
                    name: player.name,
                    tag: player.tag,
                    cardId: player.cardId,
                    rank: player.rank,
                    rankTier: player.rankTier,
                    stats: {
                        matchCount: player.matchCount,
                        totalKills: player.totalKills,
                        totalDeaths: player.totalDeaths,
                        totalAssists: player.totalAssists,
                        totalHeadshots: player.totalHeadshots,
                        wins: player.wins,
                        headshotPercent: player.headshotPercent,
                        kd: player.kd,
                        winRate: player.winRate,
                        topAgent: player.topAgent,
                        sortedMaps: player.sortedMaps,
                        aces: player.aces,
                        firstBloods: player.firstBloods,
                        knifeKills: player.knifeKills,
                        knifeDeaths: player.knifeDeaths,
                        mostPlayedStack: player.mostPlayedStack,
                        bestMatch: player.bestMatch ? {
                            player: {
                                stats: {
                                    kills: player.bestMatch.kills,
                                    deaths: player.bestMatch.deaths
                                },
                                agent: { name: player.bestMatch.agent }
                            },
                            match: {
                                metadata: {
                                    map: { name: player.bestMatch.map }
                                }
                            }
                        } : null
                    }
                }));

                renderPage(formattedData, uniqueMatches, squadWins, bestStack, allStacks);
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('content').innerHTML =
                    '<div class="loading">Error loading stats. Run generate_stats.py first.</div>';
            }
        }

        function renderPage(allPlayerData, uniqueMatches, squadWins, bestStack, allStacks) {
            // Calculate squad totals
            const squadStats = {
                totalMatches: uniqueMatches,
                totalKills: 0,
                totalDeaths: 0,
                totalAssists: 0,
                totalHeadshots: 0
            };

            allPlayerData.forEach(p => {
                squadStats.totalKills += p.stats.totalKills;
                squadStats.totalDeaths += p.stats.totalDeaths;
                squadStats.totalAssists += p.stats.totalAssists;
                squadStats.totalHeadshots += p.stats.totalHeadshots;
            });

            const squadKD = squadStats.totalDeaths > 0
                ? (squadStats.totalKills / squadStats.totalDeaths).toFixed(2)
                : squadStats.totalKills;
            const squadWinRate = squadStats.totalMatches > 0
                ? ((squadWins / squadStats.totalMatches) * 100).toFixed(0)
                : 0;

            // Find Best K/D
            const bestKD = allPlayerData.reduce((best, p) =>
                parseFloat(p.stats.kd) > parseFloat(best?.stats.kd || 0) ? p : best, null);

            let content = `
                <div class="squad-section">
                    <h2>Squad Stats</h2>
                    <p class="subtitle">Squad Data Only - 5 Stacks</p>
                    <div class="highlights">
                        <div class="highlight-card">
                            <div class="highlight-value">${allPlayerData.length}</div>
                            <div class="highlight-label">Players</div>
                        </div>
                        <div class="highlight-card">
                            <div class="highlight-value">${squadStats.totalMatches}</div>
                            <div class="highlight-label">Total Matches</div>
                        </div>
                        <div class="highlight-card">
                            <div class="highlight-value">${squadStats.totalKills.toLocaleString()}</div>
                            <div class="highlight-label">Total Kills</div>
                        </div>
                        <div class="highlight-card">
                            <div class="highlight-value">${squadKD}</div>
                            <div class="highlight-label">Squad K/D</div>
                        </div>
                        <div class="highlight-card">
                            <div class="highlight-value">${squadWinRate}%</div>
                            <div class="highlight-label">Win Rate</div>
                        </div>
                        <div class="highlight-card">
                            <div class="highlight-value name">${bestKD ? bestKD.name : 'N/A'}</div>
                            <div class="highlight-label">Best K/D (${bestKD ? bestKD.stats.kd : '0'})</div>
                        </div>
                    </div>
                    ${bestStack ? `
                        <div style="margin-top: 30px; text-align: center;">
                            <h3 style="color: #ff758c; margin-bottom: 15px;">Best 5-Stack (min. 3 games)</h3>
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; padding: 20px; max-width: 600px; margin: 0 auto;">
                                <div style="font-size: 1.1rem; margin-bottom: 10px; color: #fff;">
                                    ${bestStack.players.join(', ')}
                                </div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ff4655; margin-bottom: 5px;">
                                    ${bestStack.winRate}% Win Rate
                                </div>
                                <div style="color: #aaa; font-size: 0.9rem;">
                                    ${bestStack.wins}-${bestStack.total - bestStack.wins} (${bestStack.total} games)
                                </div>
                            </div>
                            ${allStacks.length > 1 ? `
                                <button onclick="toggleAllStacks()" style="margin-top: 20px; background: rgba(255, 70, 85, 0.2); border: 1px solid #ff4655; color: #ff4655; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(255, 70, 85, 0.3)'" onmouseout="this.style.background='rgba(255, 70, 85, 0.2)'">
                                    View All ${allStacks.length} Squad Compositions
                                </button>
                                <div id="all-stacks-container" style="display: none; margin-top: 20px;">
                                    <div style="max-width: 800px; margin: 0 auto;">
                                        ${allStacks.map((stack, index) => `
                                            <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 10px; text-align: left;">
                                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                                    <div style="flex: 1;">
                                                        <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 5px;">#${index + 1}</div>
                                                        <div style="font-size: 0.95rem; color: #fff; margin-bottom: 5px;">
                                                            ${stack.players.join(', ')}
                                                        </div>
                                                        <div style="color: #aaa; font-size: 0.85rem;">
                                                            ${stack.wins}-${stack.total - stack.wins} (${stack.total} games)
                                                        </div>
                                                    </div>
                                                    <div style="font-size: 1.3rem; font-weight: bold; color: ${index === 0 ? '#ff4655' : '#ff758c'}; margin-left: 20px;">
                                                        ${stack.winRate}%
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>

                <div class="players-section">
                    <h2>Individual Stats</h2>
                    <p class="subtitle">Squad Data Only - 5 Stacks</p>
                    <div class="players-grid" id="players-grid">
            `;

            allPlayerData.forEach((player, index) => {
                const s = player.stats;
                const maxMapKills = s.sortedMaps[0] ? s.sortedMaps[0][1] : 1;
                const cardUrl = player.cardId
                    ? `https://media.valorant-api.com/playercards/${player.cardId}/smallart.png`
                    : '';
                const rankIconUrl = player.rankTier
                    ? `https://media.valorant-api.com/competitivetiers/03621f52-342b-cf4e-4f86-9350a49c6d04/${player.rankTier}/smallicon.png`
                    : '';

                content += `
                    <div class="player-card" id="player-${index}" onclick="togglePlayer(${index})">
                        <div class="player-header">
                            <div class="player-avatar" style="${cardUrl ? `background-image: url('${cardUrl}');` : ''}">${player.name[0].toUpperCase()}</div>
                            <div class="player-info">
                                <h3>${player.name}</h3>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <span class="tag">#${player.tag || '???'}</span>
                                    ${rankIconUrl ? `<img src="${rankIconUrl}" alt="${player.rank || 'Rank'}" style="width: 20px; height: 20px;" title="${player.rank || 'Rank'}">` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="player-summary">
                            <div class="player-summary-stat">
                                <div class="value">${s.matchCount}</div>
                                <div class="label">Matches</div>
                            </div>
                            <div class="player-summary-stat">
                                <div class="value">${s.kd}</div>
                                <div class="label">K/D</div>
                            </div>
                            <div class="player-summary-stat">
                                <div class="value">${s.winRate}%</div>
                                <div class="label">Win</div>
                            </div>
                        </div>
                        <p class="click-hint">Click for details</p>

                        <div class="player-details" id="details-${index}">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value">${s.totalKills}</div>
                                    <div class="stat-label">Kills</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.totalDeaths}</div>
                                    <div class="stat-label">Deaths</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.totalAssists}</div>
                                    <div class="stat-label">Assists</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.wins}</div>
                                    <div class="stat-label">Wins</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.headshotPercent}%</div>
                                    <div class="stat-label">HS %</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.topAgent ? s.topAgent[0] : 'N/A'}</div>
                                    <div class="stat-label">Top Agent</div>
                                </div>
                            </div>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value">${s.aces || 0}</div>
                                    <div class="stat-label">Aces</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.firstBloods || 0}</div>
                                    <div class="stat-label">First Bloods</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.knifeKills || 0}</div>
                                    <div class="stat-label">Knife Kills</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${s.knifeDeaths || 0}</div>
                                    <div class="stat-label">Knife Deaths</div>
                                </div>
                            </div>

                            ${s.mostPlayedStack ? `
                            <div class="best-match">
                                <h4>Most Played Stack</h4>
                                <div class="stack-names">${s.mostPlayedStack.join(', ')}</div>
                            </div>
                            ` : ''}

                            ${s.bestMatch ? `
                            <div class="best-match">
                                <h4>Best Match</h4>
                                <div class="best-match-stats">
                                    <div class="best-match-stat">
                                        <span>${s.bestMatch.player.stats.kills}</span>
                                        <span>Kills</span>
                                    </div>
                                    <div class="best-match-stat">
                                        <span>${s.bestMatch.player.stats.deaths}</span>
                                        <span>Deaths</span>
                                    </div>
                                    <div class="best-match-stat">
                                        <span>${s.bestMatch.match.metadata.map.name}</span>
                                        <span>Map</span>
                                    </div>
                                    <div class="best-match-stat">
                                        <span>${s.bestMatch.player.agent.name}</span>
                                        <span>Agent</span>
                                    </div>
                                </div>
                            </div>
                            ` : ''}

                            <div class="maps-section">
                                <h4>Kills by Map</h4>
                                ${s.sortedMaps.slice(0, 5).map(([map, kills, games]) => `
                                    <div class="map-bar">
                                        <span class="map-name">${map} (${games})</span>
                                        <div class="map-bar-fill" style="width: ${(kills / maxMapKills) * 50}%">${kills}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });

            content += `
                    </div>
                </div>
            `;

            document.getElementById('content').innerHTML = content;
        }

        function togglePlayer(index) {
            const card = document.getElementById(`player-${index}`);
            const details = document.getElementById(`details-${index}`);
            const hint = card.querySelector('.click-hint');

            // Close all other expanded cards
            document.querySelectorAll('.player-card.expanded').forEach(c => {
                if (c.id !== `player-${index}`) {
                    c.classList.remove('expanded');
                    c.querySelector('.player-details').classList.remove('expanded');
                    c.querySelector('.click-hint').textContent = 'Click for details';
                }
            });

            card.classList.toggle('expanded');
            details.classList.toggle('expanded');
            hint.textContent = details.classList.contains('expanded') ? 'Click to collapse' : 'Click for details';
        }

        function toggleAllStacks() {
            const container = document.getElementById('all-stacks-container');
            const button = event.target;

            if (container.style.display === 'none') {
                container.style.display = 'block';
                button.textContent = 'Hide Squad Compositions';
            } else {
                container.style.display = 'none';
                const allStacksCount = container.querySelectorAll('div[style*="background: rgba(255, 255, 255, 0.03)"]').length;
                button.textContent = `View All ${allStacksCount} Squad Compositions`;
            }
        }

        loadAllData();
    </script>
</body>
</html>
